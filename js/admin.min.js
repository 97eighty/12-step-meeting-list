jQuery(function($){function setMap(latitude,longitude){if(!latitude||!longitude)return $("div#map").html(""),void 0;{var myLatlng=new google.maps.LatLng(latitude,longitude),map=new google.maps.Map(document.getElementById("map"),{zoom:16,zoomControl:!1,scrollwheel:!1,streetViewControl:!1,mapTypeControl:!1,center:myLatlng});new google.maps.Marker({position:myLatlng,map:map})}}function parseAddressComponents(components){for(var point_of_interest,neighborhood,address,city,state,postal_code,country,formatted=[],i=0;i<components.length;i++){var c=components[i];c.types.length&&"point_of_interest"!=c.types[0]?-1!==c.types.indexOf("neighborhood")?neighborhood=c.short_name:-1!==c.types.indexOf("street_number")?address=c.long_name:-1!==c.types.indexOf("route")?address=address?address+" "+c.long_name:c.long_name:-1!==c.types.indexOf("locality")?city=c.long_name:-1!==c.types.indexOf("sublocality")?city||(city=c.long_name):-1!==c.types.indexOf("administrative_area_level_3")?city||(city=c.long_name):-1!==c.types.indexOf("administrative_area_level_1")?state=c.short_name:-1!==c.types.indexOf("postal_code")?postal_code=c.short_name:-1!==c.types.indexOf("country")&&(country=c.short_name):point_of_interest=c.short_name}return!address&&point_of_interest&&(address=point_of_interest),!address&&neighborhood&&(address=neighborhood),address&&(formatted[formatted.length]=address),city&&(formatted[formatted.length]=city),state?formatted[formatted.length]=address&&postal_code?state+" "+postal_code:state:postal_code&&(formatted[formatted.length]=postal_code),country&&(formatted[formatted.length]=country),{address:address,city:city,state:state,postal_code:postal_code,country:country,formatted:formatted.join(", ")}}$("select#day").change(function(){var val=$(this).val(),$time=$("input#time");val?($("input#time").removeAttr("disabled"),!$time.val()&&$time.attr("data-value")&&$time.val($time.attr("data-value"))):$time.attr("data-value",$time.val()).val("").attr("disabled","disabled")}),$("#get_feedback table span").click(function(){$(this).parent().submit()});var locations=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=location"}});locations.initialize(),$("input#location").typeahead(null,{displayKey:"value",source:locations.ttAdapter()}).on("typeahead:autocompleted",function($e,datum){$("input[name=formatted_address]").val(datum.formatted_address),$("input[name=latitude]").val(datum.latitude),$("input[name=longitude]").val(datum.longitude),$("input[name=address]").val(datum.address),$("input[name=city]").val(datum.city),$("input[name=state]").val(datum.state),$("input[name=postal_code]").val(datum.postal_code),$("input[name=country]").val(datum.country),$("select[name=region] option[value="+datum.region+"]").prop("selected",!0),$("textarea[name=location_notes]").val(datum.notes),setMap(datum.latitude,datum.longitude)});var groups=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=tsml_group",ttl:10}});groups.initialize(),$("input#group").typeahead(null,{displayKey:"value",source:groups.ttAdapter()}).on("typeahead:autocompleted",function($e,datum){$("input[name=contact_1_name]").val(datum.contact_1_name),$("input[name=contact_1_email]").val(datum.contact_1_email),$("input[name=contact_1_phone]").val(datum.contact_1_phone),$("input[name=contact_2_name]").val(datum.contact_2_name),$("input[name=contact_2_email]").val(datum.contact_2_email),$("input[name=contact_2_phone]").val(datum.contact_2_phone),$("input[name=contact_3_name]").val(datum.contact_3_name),$("input[name=contact_3_email]").val(datum.contact_3_email),$("input[name=contact_3_phone]").val(datum.contact_3_phone),$("textarea[name=group_notes]").val(datum.notes)}),$("input#group").change(function(){$("div#group .apply_group_to_location").removeClass("hidden")}),$("form#post").submit(function(){if(!$("select#day").val())return $("input#time").val(""),!0;var timeVal=$("input#time").val(),errors=!1;5!=timeVal.length&&(errors=!0),2!=timeVal.indexOf(":")&&(errors=!0);var hours=timeVal.substr(0,2),minutes=timeVal.substr(3,2);return(isNaN(hours)||0>hours||hours>23)&&(errors=!0),(isNaN(minutes)||0>minutes||minutes>59)&&(errors=!0),errors?(alert("Time should be 24-hour format HH:MM."),!1):!0}),$("input#formatted_address").blur(function(){$("input#address").val(""),$("input#city").val(""),$("input#state").val(""),$("input#zip").val(""),$("input#country").val(""),$("input#latitude").val(""),$("input#longitude").val("");var val=$(this).val().trim();return val.length?(jQuery.getJSON("https://maps.googleapis.com/maps/api/geocode/json",{address:val,key:myAjax.google_api_key},function(data){if("OK"==data.status){var latitude=data.results[0].geometry.location.lat,longitude=data.results[0].geometry.location.lng;$("input#latitude").val(latitude),$("input#longitude").val(longitude),setMap(latitude,longitude);var region_id=!1;$("select#region option[selected]").size()||(val=data.results[0].formatted_address,$("select#region option").each(function(){var region_name=$(this).text().replace("&nbsp;","").trim();-1!=val.indexOf(region_name)&&(region_id=$(this).attr("value"))}));var address=parseAddressComponents(data.results[0].address_components);$("input#address").val(address.address),$("input#city").val(address.city),$("input#state").val(address.state),$("input#postal_code").val(address.postal_code),$("input#country").val(address.country),$("input#formatted_address").val(address.formatted),jQuery.getJSON(myAjax.ajaxurl+"?action=address",{formatted_address:address.formatted},function(data){data?($("input[name=location]").val(data.location),$("select[name=region] option").prop("selected",!1),$("select[name=region] option[value="+data.region+"]").prop("selected",!0),$("textarea[name=location_notes]").val(data.location_notes)):region_id&&($("select[name=region] option").prop("selected",!1),$("select[name=region] option[value="+region_id+"]").prop("selected",!0))})}}),void 0):(setMap(),$("input#formatted_address").val(""),void 0)}),$("input#formatted_address").val()&&$("input#formatted_address").blur()});