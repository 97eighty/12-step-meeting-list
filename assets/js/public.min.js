function loadMap(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t],s=new google.maps.Marker({position:{lat:a.latitude-0,lng:a.longitude-0},map:map,title:a.name});s.content='<div class="infowindow"><h3>'+formatLink(a.url,a.name,"post_type")+"</h3><address>"+a.address+"<br>"+a.city+(a.state?", "+a.state:"")+"</address>";for(var i=null,n=0;n<a.meetings.length;n++){var o=a.meetings[n];i!=o.day&&(i&&(s.content+="</dl>"),i=o.day,"undefined"!=typeof days[i]&&(s.content+="<h5>"+days[i]+"</h5>"),s.content+="<dl>"),s.content+="<dt>"+o.time+"</dt><dd>"+formatLink(o.url,o.name,"post_type")+"</dd>"}s.content+="</dl></div>",google.maps.event.addListener(s,"click",function(e){return function(){infowindow.setContent(e.content),infowindow.open(map,e)}}(s)),bounds.extend(s.position),markers[markers.length]=s}markers.length>1?map.fitBounds(bounds):1==markers.length?(map.setCenter(bounds.getCenter()),jQuery("#map").is(":visible")&&google.maps.event.trigger(markers[0],"click"),map.setZoom(14)):0==markers.length}function formatLink(e,t,a){for(var s=location.search.substr(1).split("&"),i=[],n=0;n<s.length;n++){var o=s[n].split("=");o[0]!=a&&(i[i.length]=o[0]+"="+o[1])}return i.length&&(e+=(e.indexOf("?")==-1?"?":"&")+i.join("&")),'<a href="'+e+'">'+t+"</a>"}function updateQueryString(e,t,a){a||(a=window.location.href);var s,i=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(i.test(a))return"undefined"!=typeof t&&null!==t?a.replace(i,"$1"+e+"="+t+"$2$3"):(s=a.split("#"),a=s[0].replace(i,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof s[1]&&null!==s[1]&&(a+="#"+s[1]),a);if("undefined"!=typeof t&&null!==t){var n=a.indexOf("?")!==-1?"&":"?";return s=a.split("#"),a=s[0]+n+e+"="+t,"undefined"!=typeof s[1]&&null!==s[1]&&(a+="#"+s[1]),a}return a}jQuery(function(e){function t(){var i={action:"meetings",search:e("#search input[name=query]").val().trim(),day:e("#day li.active a").attr("data-id"),time:e("#time li.active a").attr("data-id"),region:e("#region li.active a").attr("data-id"),type:e("#type li.active a").attr("data-id")},n={};if(i.search&&(n.sq=i.search),n.d=i.day?i.day:"any",i.time&&(n.i=i.time),i.region&&(n.r=i.region),i.type&&(n.t=i.type),n.v=e("#meetings .toggle-view.active").attr("data-id"),n=jQuery.param(n),history.pushState){var r=window.location.protocol+"//"+window.location.host+window.location.pathname;n.length&&(r=r+"?"+n),location.search.indexOf("post_type=meetings")>-1&&(r=r+(r.indexOf("?")>-1?"&":"?")+"post_type=meetings"),window.history.pushState({path:r},"",r)}var l=[];if(i.search){l=i.search.split(" ");for(var d=0;d<l.length;d++)l[d]=new RegExp("("+l[d]+")","gi")}jQuery.post(myAjax.ajaxurl,i,function(n){if(n.length){e("#meetings table").removeClass("hidden"),e("#meetings #map").hasClass("hidden")&&(e("#meetings #map").removeClass("hidden"),google.maps.event.trigger(map,"resize")),e("#alert").addClass("hidden");var r=[],d=e("#meetings_tbody").html("");jQuery.each(n,function(e,t){jQuery.inArray("M",t.types)!=-1?t.name+=" <small>Men</small>":jQuery.inArray("W",t.types)!=-1&&(t.name+=" <small>Women</small>"),r[t.location_id]||(r[t.location_id]={name:t.location,address:t.address,latitude:t.latitude,longitude:t.longitude,city:t.city,state:t.state,url:t.location_url,meetings:[]}),r[t.location_id].meetings[r[t.location_id].meetings.length]={name:t.name,time:t.time_formatted,day:t.day,notes:t.notes,url:t.url};var a=t.day+"-"+("00:00"==t.time?"11:59":t.time);d.append('<tr><td class="time" data-sort="'+a+'"><span>'+(i.day||!t.day?t.time_formatted:days[t.day]+"</span><span>"+t.time_formatted)+'</span></td><td class="name" data-sort="'+t.name+"-"+a+'">'+formatLink(t.url,s(t.name,l),"post_type")+'</td><td class="location" data-sort="'+t.location+"-"+a+'">'+s(t.location,l)+'</td><td class="address" data-sort="'+t.address+"-"+a+'">'+s(t.address,l)+'</td><td class="region" data-sort="'+(t.sub_region||t.region||"")+"-"+a+'">'+(t.sub_region||t.region||"")+'</td><td class="types" data-sort="'+o(t.types)+"-"+a+'">'+o(t.types)+"</td></tr>")}),a();for(var m=0;m<markers.length;m++)markers[m].setMap(null);markers=[],bounds=new google.maps.LatLngBounds,loadMap(r)}else{if(i.search&&("undefined"!=typeof i.day||"undefined"!=typeof i.region||"undefined"!=typeof i.time||"undefined"!=typeof i.type))return e("#day li").removeClass("active").first().addClass("active"),e("#time li").removeClass("active").first().addClass("active"),e("#region li").removeClass("active").first().addClass("active"),e("#type li").removeClass("active").first().addClass("active"),e("#day span.selected").html(e("#day li:first-child a").html()),e("#time span.selected").html(e("#time li:first-child a").html()),e("#region span.selected").html(e("#region li:first-child a").html()),e("#type span.selected").html(e("#type li:first-child a").html()),t();e("#meetings table").addClass("hidden"),e("#meetings #map").addClass("hidden"),e("#alert").html("No results matched those criteria.").removeClass("hidden")}},"json")}function a(){$sorted=e("#meetings table thead th[data-sort]").first();for(var t=($sorted.attr("class"),$sorted.attr("data-sort")),a=document.getElementById("meetings_tbody"),s=[],i=e("#meetings table thead th").index($sorted),n=0,o=a.rows.length;n<o;n++){var r=a.rows[n];s.push([r.cells[i].getAttribute("data-sort"),r])}s.sort(function(e,a){return e[0]>a[0]?"asc"==t?1:-1:e[0]<a[0]?"asc"==t?-1:1:0});for(var n=0,o=s.length;n<o;n++)a.appendChild(s[n][1])}function s(e,t){if(!t.length)return e;for(var a=0;a<t.length;a++)e=e.replace(t[a],"<mark>$1</mark>");return e}function i(){e("body").hasClass("tsml_fullscreen")&&(e("body").removeClass("tsml_fullscreen"),e('a[href="#fullscreen"]').removeClass("active"),e('a[href="#fullscreen"]').parent().removeClass("active"),e("#map").css("height",550))}function n(){var t="";e("#meetings #day li.active").index()&&(t+=e("#meetings #day span.selected").text()),e("#meetings #time li.active").index()&&(t+=" "+e("#meetings #time span.selected").text()),e("#meetings #type li.active").index()&&(t+=" "+e("#meetings #type span.selected").text()),t+=" Meetings",e("#meetings #region li.active").index()&&(t+=" in "+e("#meetings #region span.selected").text()),document.title=t}function o(e){for(var t=[],a=0;a<e.length;a++)t[t.length]=myAjax.types[e[a]];return t.sort(),t.join(", ")}e('#meeting #feedback a[href="#report"]').click(function(t){t.preventDefault(),e(this).closest("#feedback").attr("class","form")}),e('#meeting #feedback a[href="#cancel"]').click(function(t){t.preventDefault(),e(this).closest("#feedback").attr("class","")}),e("#meeting #feedback form").validate({onfocusout:!1,onkeyup:function(e){},highlight:function(t,a,s){e(t).closest("div.form-group").addClass("has-error")},unhighlight:function(t,a,s){e(t).closest("div.form-group").removeClass("has-error")},errorPlacement:function(e,t){},submitHandler:function(t){var a=e(t),s=a.closest("#feedback"),i=s.find(".alert").first();return e.post(myAjax.ajaxurl,a.serialize(),function(e){i.removeClass("alert-danger").addClass("alert-warning").html(e),s.attr("class","confirm")}).fail(function(e){i.removeClass("alert-warning").addClass("alert-danger").html("Email was not sent."),s.attr("class","confirm")}),!1}});var r;"https:"===location.protocol&&navigator.geolocation&&e("li.geolocator").removeClass("hidden"),e("#meetings table thead").on("click","th",function(){var t,s=e(this).attr("class");t=e(this).attr("data-sort")&&"asc"==e(this).attr("data-sort")?"desc":"asc",e("#meetings table thead th").removeAttr("data-sort"),e("#meetings table thead th."+s).attr("data-sort",t),a()}),e("#meetings #search").submit(function(e){return t(),!1}),e("#meetings .controls").on("click",".dropdown-menu a",function(a){a.preventDefault(),"day"==e(this).closest(".dropdown").attr("id")&&(e("#day li").removeClass("active"),e("#day span.selected").html(e(this).html())),"time"==e(this).closest(".dropdown").attr("id")&&(e("#time li").removeClass("active"),e("#time span.selected").html(e(this).html())),"region"==e(this).closest(".dropdown").attr("id")&&(e("#region li").removeClass("active"),e("#region span.selected").html(e(this).html())),"type"==e(this).closest(".dropdown").attr("id")&&(e("#type li").removeClass("active"),e("#type span.selected").html(e(this).html())),e(this).parent().toggleClass("active"),n(),t()}),e("#meetings #action .toggle-view").click(function(t){t.preventDefault();var a=e(this).attr("data-id"),s=e("#meetings").attr("data-type");if(history.pushState){var n=updateQueryString("v",a);window.history.pushState({path:n},"",n)}"list"==a?(i(),e("#meetings #action .toggle-view[data-id=list]").addClass("active"),e("#meetings #action .toggle-view[data-id=map]").removeClass("active")):"map"==a&&(e("#meetings #action .toggle-view[data-id=map]").addClass("active"),e("#meetings #action .toggle-view[data-id=list]").removeClass("active")),e("#meetings").attr("data-type",a),"map"==a&&a!=s&&(google.maps.event.trigger(map,"resize"),map.fitBounds(bounds),1==markers.length&&e("#map").is(":visible")&&(map.setZoom(14),google.maps.event.trigger(markers[0],"click")))}),e('a[href="#geolocator"]').click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(this).hasClass("active")?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);r=new google.maps.Marker({icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",position:t,map:map,title:"You"}),map.setCenter(t),map.setZoom(13)},function(t){e(this).removeClass("active")}):void 0!==r&&r.setMap(null)}),e('a[href="#fullscreen"]').click(function(t){t.preventDefault();var a=map.getCenter();if(e(this).toggleClass("active"),e(this).hasClass("active")){e("body").addClass("tsml_fullscreen");var s=e(window).height()-79;e("body").hasClass("admin-bar")&&(s-=32),e("#map").css("height",s)}else i();google.maps.event.trigger(map,"resize"),map.setCenter(a)}),e(document).keyup(function(e){27==e.keyCode&&i()}),e("body").hasClass("post-type-archive-meetings")&&n(),e(window).resize(function(t){if(e("#meetings").hasClass("tsml_fullscreen")){var a=map.getCenter(),s=e(window).height()-79;e("body").hasClass("admin-bar")&&(s-=32),e("#map").css("height",s),google.maps.event.trigger(map,"resize"),map.setCenter(a)}})}),markers=[],map=new google.maps.Map(document.getElementById("map"),{panControl:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}}),bounds=new google.maps.LatLngBounds,days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],infowindow=new google.maps.InfoWindow;