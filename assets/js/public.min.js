"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function loadMap(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t],n=new google.maps.Marker({position:{lat:a.latitude-0,lng:a.longitude-0},map:map,title:a.name});n.content='<div class="infowindow"><h3>'+formatLink(a.url,a.name,"post_type")+"</h3><address>"+a.address+"<br>"+a.city+(a.state?", "+a.state:"")+"</address>";for(var i=null,r=0;r<a.meetings.length;r++){var s=a.meetings[r];i!=s.day&&(i&&(n.content+="</dl>"),i=s.day,"undefined"!=typeof days[i]&&(n.content+="<h5>"+days[i]+"</h5>"),n.content+="<dl>"),n.content+="<dt>"+s.time+"</dt><dd>"+formatLink(s.url,s.name,"post_type")+"</dd>"}n.content+="</dl></div>",google.maps.event.addListener(n,"click",function(e){return function(){infowindow.setContent(e.content),infowindow.open(map,e)}}(n)),bounds.extend(n.position),markers[markers.length]=n}markers.length>1?map.fitBounds(bounds):1==markers.length?(map.setCenter(bounds.getCenter()),jQuery("#map").is(":visible")&&google.maps.event.trigger(markers[0],"click"),map.setZoom(14)):0==markers.length}function formatLink(e,t,a){for(var n=location.search.substr(1).split("&"),i=[],r=0;r<n.length;r++){var s=n[r].split("=");s[0]!=a&&(i[i.length]=s[0]+"="+s[1])}return i.length&&(e+=(e.indexOf("?")==-1?"?":"&")+i.join("&")),'<a href="'+e+'">'+t+"</a>"}function updateQueryString(e,t,a){a||(a=window.location.href);var n,i=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(i.test(a))return"undefined"!=typeof t&&null!==t?a.replace(i,"$1"+e+"="+t+"$2$3"):(n=a.split("#"),a=n[0].replace(i,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof n[1]&&null!==n[1]&&(a+="#"+n[1]),a);if("undefined"!=typeof t&&null!==t){var r=a.indexOf("?")!==-1?"&":"?";return n=a.split("#"),a=n[0]+r+e+"="+t,"undefined"!=typeof n[1]&&null!==n[1]&&(a+="#"+n[1]),a}return a}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t,a){"function"==typeof define&&define.amd?define(["jquery"],function(n){return e(t,a,n)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(t,a,require("jquery")):e(t,a,jQuery)}(function(e,t,a){var n=function(){function a(e){_classCallCheck(this,a),this.ctx=e}return _createClass(a,[{key:"log",value:function n(e){var t=arguments.length<=1||void 0===arguments[1]?"debug":arguments[1],n=this.opt.log;this.opt.debug&&"object"===("undefined"==typeof n?"undefined":_typeof(n))&&"function"==typeof n[t]&&n[t]("mark.js: "+e)}},{key:"escapeStr",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"createRegExp",value:function(e){return e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),e=this.createAccuracyRegExp(e)}},{key:"createSynonymsRegExp",value:function(e){var t=this.opt.synonyms;for(var a in t)if(t.hasOwnProperty(a)){var n=t[a],i=this.escapeStr(a),r=this.escapeStr(n);e=e.replace(new RegExp("("+i+"|"+r+")","gmi"),"("+i+"|"+r+")")}return e}},{key:"createDiacriticsRegExp",value:function(e){var t=["aÀÁÂÃÄÅàáâãäåĀāąĄ","cÇçćĆčČ","dđĐďĎ","eÈÉÊËèéêëěĚĒēęĘ","iÌÍÎÏìíîïĪī","lłŁ","nÑñňŇńŃ","oÒÓÔÕÕÖØòóôõöøŌō","rřŘ","sŠšśŚ","tťŤ","uÙÚÛÜùúûüůŮŪū","yŸÿýÝ","zŽžżŻźŹ"],a=[];return e.split("").forEach(function(n){t.every(function(t){if(t.indexOf(n)!==-1){if(a.indexOf(t)>-1)return!1;e=e.replace(new RegExp("["+t+"]","gmi"),"["+t+"]"),a.push(t)}return!0})}),e}},{key:"createMergedBlanksRegExp",value:function(e){return e.replace(/[\s]+/gim,"[\\s]*")}},{key:"createAccuracyRegExp",value:function(e){var t=this,a=this.opt.accuracy,n="string"==typeof a?a:a.value,i="string"==typeof a?[]:a.limiters,r="";switch(i.forEach(function(e){r+="|"+t.escapeStr(e)}),n){case"partially":return"()("+e+")";case"complementary":return"()([^\\s"+r+"]*"+e+"[^\\s"+r+"]*)";case"exactly":return"(^|\\s"+r+")("+e+")(?=$|\\s"+r+")"}}},{key:"getSeparatedKeywords",value:function(e){var t=this,a=[];return e.forEach(function(e){t.opt.separateWordSearch?e.split(" ").forEach(function(e){e.trim()&&a.push(e)}):e.trim()&&a.push(e)}),{keywords:a,length:a.length}}},{key:"getElements",value:function(){var e=void 0,t=[];return e="undefined"==typeof this.ctx?[]:this.ctx instanceof HTMLElement?[this.ctx]:Array.isArray(this.ctx)?this.ctx:Array.prototype.slice.call(this.ctx),e.forEach(function(e){if(t.indexOf(e)===-1){t.push(e);var a=e.querySelectorAll("*");a.length&&(t=t.concat(Array.prototype.slice.call(a)))}}),e.length||this.log("Empty context","warn"),{elements:t,length:t.length}}},{key:"matches",value:function(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)}},{key:"matchesExclude",value:function(e,t){var a=this,n=!0,i=this.opt.exclude.concat(["script","style","title"]);return this.opt.iframes||(i=i.concat(["iframe"])),t&&(i=i.concat(["*[data-markjs='true']"])),i.every(function(t){return!a.matches(e,t)||(n=!1)}),!n}},{key:"onIframeReady",value:function(e,t,a){try{!function(){var n=e.contentWindow,i="about:blank",r="complete",s=function(){try{if(null===n.document)throw new Error("iframe inaccessible");t(n.document)}catch(e){a()}},o=function(){var t=e.getAttribute("src").trim(),a=n.location.href;return a===i&&t!==i&&t},l=function(){var t=function n(){try{o()||(e.removeEventListener("load",n),s())}catch(t){a()}};e.addEventListener("load",t)};n.document.readyState===r?o()?l():s():l()}()}catch(n){a()}}},{key:"forEachElementInIframe",value:function(e,t){var a=this,n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],i=0,r=function(){--i<1&&n()};this.onIframeReady(e,function(e){var n=Array.prototype.slice.call(e.querySelectorAll("*"));0===(i=n.length)&&r(),n.forEach(function(e){"iframe"===e.tagName.toLowerCase()?!function(){var n=0;a.forEachElementInIframe(e,function(e,a){t(e,a),a-1===n&&r(),n++},r)}():(t(e,n.length),r())})},function(){var t=e.getAttribute("src");a.log("iframe '"+t+"' could not be accessed","warn"),r()})}},{key:"forEachElement",value:function(e){var t=this,a=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2],i=this.getElements(),r=i.elements,s=i.length,o=function(){0===--s&&a()};o(++s),r.forEach(function(a){if(!t.matchesExclude(a,n)){if("iframe"===a.tagName.toLowerCase())return void t.forEachElementInIframe(a,function(a){t.matchesExclude(a,n)||e(a)},o);e(a)}o()})}},{key:"forEachNode",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.forEachElement(function(t){for(t=t.firstChild;t;t=t.nextSibling)3===t.nodeType&&t.textContent.trim()&&e(t)},t)}},{key:"wrapMatches",value:function(e,a,n,i,r){for(var s=this.opt.element?this.opt.element:"mark",o=n?0:2,l=void 0;null!==(l=a.exec(e.textContent));)if(i(l[o])){var c=l.index;n||(c+=l[o-1].length);var d=e.splitText(c);if(e=d.splitText(l[o].length),null!==d.parentNode){var u=t.createElement(s);u.setAttribute("data-markjs","true"),this.opt.className&&u.setAttribute("class",this.opt.className),u.textContent=l[o],d.parentNode.replaceChild(u,d),r(u)}a.lastIndex=0}}},{key:"unwrapMatches",value:function(e){for(var a=e.parentNode,n=t.createDocumentFragment();e.firstChild;)n.appendChild(e.removeChild(e.firstChild));a.replaceChild(n,e),a.normalize()}},{key:"markRegExp",value:function(e,t){var a=this;this.opt=t,this.log('Searching with expression "'+e+'"');var n=0,i=function(e){n++,a.opt.each(e)};this.forEachNode(function(t){a.wrapMatches(t,e,!0,function(e){return a.opt.filter(t,e,n)},i)},function(){0===n&&a.opt.noMatch(e),a.opt.done(n)})}},{key:"mark",value:function(e,t){var a=this;this.opt=t;var n=this.getSeparatedKeywords("string"==typeof e?[e]:e),i=n.keywords,r=n.length,s=0;0===r&&this.opt.done(s),i.forEach(function(e){var t=new RegExp(a.createRegExp(e),"gmi"),n=0,o=function(e){n++,s++,a.opt.each(e)};a.log('Searching with expression "'+t+'"'),a.forEachNode(function(i){a.wrapMatches(i,t,!1,function(){return a.opt.filter(i,e,n,s)},o)},function(){0===n&&a.opt.noMatch(e),i[r-1]===e&&a.opt.done(s)})})}},{key:"unmark",value:function(e){var t=this;this.opt=e;var a=this.opt.element?this.opt.element:"*";a+="[data-markjs]",this.opt.className&&(a+="."+this.opt.className),this.log('Removal selector "'+a+'"'),this.forEachElement(function(e){t.matches(e,a)&&t.unwrapMatches(e)},function(){t.opt.done()},!1)}},{key:"opt",set:function(t){this._opt=_extends({},{element:"",className:"",exclude:[],iframes:!1,separateWordSearch:!0,diacritics:!0,synonyms:{},accuracy:"partially",each:function(){},noMatch:function(){},filter:function(){return!0},done:function(){},debug:!1,log:e.console},t)},get:function(){return this._opt}}]),a}();return a.fn.mark=function(e,t){return new n(this).mark(e,t),this},a.fn.markRegExp=function(e,t){return new n(this).markRegExp(e,t),this},a.fn.unmark=function(e){return new n(this).unmark(e),this},a},window,document),jQuery(function(e){function t(){var n={action:"meetings",search:e("#search input[name=query]").val().trim(),day:e("#day li.active a").attr("data-id"),time:e("#time li.active a").attr("data-id"),region:e("#region li.active a").attr("data-id"),type:e("#type li.active a").attr("data-id")},i={};if(n.search&&(i.sq=n.search),i.d=n.day?n.day:"any",n.time&&(i.i=n.time),n.region&&(i.r=n.region),n.type&&(i.t=n.type),i.v=e("#meetings .toggle-view.active").attr("data-id"),i=jQuery.param(i),history.pushState){var s=window.location.protocol+"//"+window.location.host+window.location.pathname;i.length&&(s=s+"?"+i),location.search.indexOf("post_type=meetings")>-1&&(s=s+(s.indexOf("?")>-1?"&":"?")+"post_type=meetings"),window.history.pushState({path:s},"",s)}jQuery.post(myAjax.ajaxurl,n,function(i){if(i.length){e("#meetings table").removeClass("hidden"),e("#meetings #map").hasClass("hidden")&&(e("#meetings #map").removeClass("hidden"),google.maps.event.trigger(map,"resize")),e("#alert").addClass("hidden");var s=[],o=e("#meetings_tbody").html("");jQuery.each(i,function(e,t){jQuery.inArray("M",t.types)!=-1?t.name+=" <small>Men</small>":jQuery.inArray("W",t.types)!=-1&&(t.name+=" <small>Women</small>"),s[t.location_id]||(s[t.location_id]={name:t.location,address:t.address,latitude:t.latitude,longitude:t.longitude,city:t.city,state:t.state,url:t.location_url,meetings:[]}),s[t.location_id].meetings[s[t.location_id].meetings.length]={name:t.name,time:t.time_formatted,day:t.day,notes:t.notes,url:t.url};var a=t.day+"-"+("00:00"==t.time?"23:59":t.time);o.append('<tr><td class="time" data-sort="'+a+'"><span>'+(n.day||!t.day?t.time_formatted:days[t.day]+"</span><span>"+t.time_formatted)+'</span></td><td class="name" data-sort="'+t.name+"-"+a+'">'+formatLink(t.url,t.name,"post_type")+'</td><td class="location" data-sort="'+t.location+"-"+a+'">'+t.location+'</td><td class="address" data-sort="'+t.address+"-"+a+'">'+t.address+'</td><td class="region" data-sort="'+(t.sub_region||t.region||"")+"-"+a+'">'+(t.sub_region||t.region||"")+'</td><td class="types" data-sort="'+r(t.types)+"-"+a+'">'+r(t.types)+"</td></tr>")}),a(),n.search&&e("#meetings .results tbody").mark(n.search);for(var l=0;l<markers.length;l++)markers[l].setMap(null);markers=[],bounds=new google.maps.LatLngBounds,loadMap(s)}else{if(n.search&&("undefined"!=typeof n.day||"undefined"!=typeof n.region||"undefined"!=typeof n.time||"undefined"!=typeof n.type))return e("#day li").removeClass("active").first().addClass("active"),e("#time li").removeClass("active").first().addClass("active"),e("#region li").removeClass("active").first().addClass("active"),e("#type li").removeClass("active").first().addClass("active"),e("#day span.selected").html(e("#day li:first-child a").html()),e("#time span.selected").html(e("#time li:first-child a").html()),e("#region span.selected").html(e("#region li:first-child a").html()),e("#type span.selected").html(e("#type li:first-child a").html()),t();e("#meetings table").addClass("hidden"),e("#meetings #map").addClass("hidden"),e("#alert").html("No results matched those criteria.").removeClass("hidden")}},"json")}function a(){for(var t=e("#meetings table thead th[data-sort]").first(),a=(t.attr("class"),t.attr("data-sort")),n=document.getElementById("meetings_tbody"),i=[],r=e("#meetings table thead th").index(t),s=0,o=n.rows.length;s<o;s++){var l=n.rows[s];i.push([l.cells[r].getAttribute("data-sort"),l])}i.sort(function(e,t){return e[0]>t[0]?"asc"==a?1:-1:e[0]<t[0]?"asc"==a?-1:1:0});for(var s=0,o=i.length;s<o;s++)n.appendChild(i[s][1])}function n(){e("body").hasClass("tsml_fullscreen")&&(e("body").removeClass("tsml_fullscreen"),e('a[href="#fullscreen"]').removeClass("active"),e('a[href="#fullscreen"]').parent().removeClass("active"),e("#map").css("height",550))}function i(){var t="";e("#meetings #day li.active").index()&&(t+=e("#meetings #day span.selected").text()),e("#meetings #time li.active").index()&&(t+=" "+e("#meetings #time span.selected").text()),e("#meetings #type li.active").index()&&(t+=" "+e("#meetings #type span.selected").text()),t+=" Meetings",e("#meetings #region li.active").index()&&(t+=" in "+e("#meetings #region span.selected").text()),document.title=t}function r(e){for(var t=[],a=0;a<e.length;a++)t[t.length]=myAjax.types[e[a]];return t.sort(),t.join(", ")}e('#meeting #feedback a[href="#report"]').click(function(t){t.preventDefault(),e(this).closest("#feedback").attr("class","form")}),e('#meeting #feedback a[href="#cancel"]').click(function(t){t.preventDefault(),e(this).closest("#feedback").attr("class","")}),e("#meeting #feedback form").validate({onfocusout:!1,onkeyup:function(e){},highlight:function(t,a,n){e(t).closest("div.form-group").addClass("has-error")},unhighlight:function(t,a,n){e(t).closest("div.form-group").removeClass("has-error")},errorPlacement:function(e,t){},submitHandler:function(t){var a=e(t),n=a.closest("#feedback"),i=n.find(".alert").first();return e.post(myAjax.ajaxurl,a.serialize(),function(e){i.removeClass("alert-danger").addClass("alert-warning").html(e),n.attr("class","confirm")}).fail(function(e){i.removeClass("alert-warning").addClass("alert-danger").html("Email was not sent."),n.attr("class","confirm")}),!1}});var s;"https:"===location.protocol&&navigator.geolocation&&e("li.geolocator").removeClass("hidden"),e("#meetings table thead").on("click","th",function(){var t,n=e(this).attr("class");t=e(this).attr("data-sort")&&"asc"==e(this).attr("data-sort")?"desc":"asc",e("#meetings table thead th").removeAttr("data-sort"),e("#meetings table thead th."+n).attr("data-sort",t),a()}),e("#meetings #search").submit(function(e){return t(),!1});var o=e("#meetings #search input[name=query]");o.size()&&o.val().length&&e("#meetings .results tbody").mark(o.val()),e("#meetings .controls").on("click",".dropdown-menu a",function(a){a.preventDefault(),"day"==e(this).closest(".dropdown").attr("id")&&(e("#day li").removeClass("active"),e("#day span.selected").html(e(this).html())),"time"==e(this).closest(".dropdown").attr("id")&&(e("#time li").removeClass("active"),e("#time span.selected").html(e(this).html())),"region"==e(this).closest(".dropdown").attr("id")&&(e("#region li").removeClass("active"),e("#region span.selected").html(e(this).html())),"type"==e(this).closest(".dropdown").attr("id")&&(e("#type li").removeClass("active"),e("#type span.selected").html(e(this).html())),e(this).parent().toggleClass("active"),i(),t()}),e("#meetings #action .toggle-view").click(function(t){t.preventDefault();var a=e(this).attr("data-id"),i=e("#meetings").attr("data-type");if(history.pushState){var r=updateQueryString("v",a);window.history.pushState({path:r},"",r)}"list"==a?(n(),e("#meetings #action .toggle-view[data-id=list]").addClass("active"),e("#meetings #action .toggle-view[data-id=map]").removeClass("active")):"map"==a&&(e("#meetings #action .toggle-view[data-id=map]").addClass("active"),e("#meetings #action .toggle-view[data-id=list]").removeClass("active")),e("#meetings").attr("data-type",a),"map"==a&&a!=i&&(google.maps.event.trigger(map,"resize"),map.fitBounds(bounds),1==markers.length&&e("#map").is(":visible")&&(map.setZoom(14),google.maps.event.trigger(markers[0],"click")))}),e('a[href="#geolocator"]').click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(this).hasClass("active")?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);s=new google.maps.Marker({icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",position:t,map:map,title:"You"}),map.setCenter(t),map.setZoom(13)},function(t){e(this).removeClass("active")}):void 0!==s&&s.setMap(null)}),e('a[href="#fullscreen"]').click(function(t){t.preventDefault();var a=map.getCenter();if(e(this).toggleClass("active"),e(this).hasClass("active")){e("body").addClass("tsml_fullscreen");var i=e(window).height()-79;e("body").hasClass("admin-bar")&&(i-=32),e("#map").css("height",i)}else n();google.maps.event.trigger(map,"resize"),map.setCenter(a)}),e(document).keyup(function(e){27==e.keyCode&&n()}),e("body").hasClass("post-type-archive-meetings")&&i(),e(window).resize(function(t){if(e("#meetings").hasClass("tsml_fullscreen")){var a=map.getCenter(),n=e(window).height()-79;e("body").hasClass("admin-bar")&&(n-=32),e("#map").css("height",n),google.maps.event.trigger(map,"resize"),map.setCenter(a)}})});var markers=[],map=new google.maps.Map(document.getElementById("map"),{panControl:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}}),bounds=new google.maps.LatLngBounds,days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],infowindow=new google.maps.InfoWindow;