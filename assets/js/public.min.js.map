{"version":3,"sources":["public.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"public.min.js","sourcesContent":["jQuery(function($){\n\t\n\t//single meeting page feedback form\n\t$('#meeting #feedback a[href=\"#report\"]').click(function(e){\n\t\te.preventDefault();\n\t\t$(this).closest('#feedback').attr('class', 'form');\n\t});\n\t\n\t$('#meeting #feedback a[href=\"#cancel\"]').click(function(e){\n\t\te.preventDefault();\n\t\t$(this).closest('#feedback').attr('class', '');\n\t});\n\t\n\t$('#meeting #feedback form').validate({\n\t\tonfocusout:false,\n    \tonkeyup: function(element) { },\n\t\thighlight: function(element, errorClass, validClass) {\n\t\t\t$(element).closest('div.form-group').addClass('has-error');\n\t\t},\n\t\tunhighlight: function(element, errorClass, validClass) {\n\t\t\t$(element).closest('div.form-group').removeClass('has-error');\n\t\t},\n\t\terrorPlacement: function(error, element) {\n\t\t\treturn; //don't show message on page, simply highlight\n\t\t}, \n\t\tsubmitHandler: function(form){\n\t\t\tvar $form = $(form),\n\t\t\t\t$feedback = $form.closest('#feedback'), \n\t\t\t\t$alert = $feedback.find('.alert').first();\n\t\t\t$.post(myAjax.ajaxurl, $form.serialize(), function(data) {\n\t\t\t\t$alert.removeClass('alert-danger').addClass('alert-warning').html(data);\n\t\t\t\t$feedback.attr('class', 'confirm');\n\t\t\t}).fail(function(response) {\n\t\t\t\t$alert.removeClass('alert-warning').addClass('alert-danger').html('Email was not sent.');\n\t\t\t\t$feedback.attr('class', 'confirm');\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\t});\n\t\n\t//meetings list page\n\tvar userMarker;\n\tif ((location.protocol === 'https:') && navigator.geolocation) {\n\t\t$('li.geolocator').removeClass('hidden');\n\t}\n\n\t//run search (triggered by dropdown toggle or form submit)\n\tfunction doSearch() {\n\n\t\t//prepare data for ajax\n\t\tvar data = { \n\t\t\taction: 'meetings',\n\t\t\tsearch: $('#search input[name=query]').val().trim(),\n\t\t\tday: \t$('#day li.active a').attr('data-id'),\n\t\t\ttime:   $('#time li.active a').attr('data-id'),\n\t\t\tregion: $('#region li.active a').attr('data-id'),\n\t\t\ttype:   $('#type li.active a').attr('data-id'),\n\t\t}\n\t\t\n\t\t//get current query string for history and appending to links\n\t\tvar querystring = {};\n\t\tif (data.search) querystring.sq = data.search;\n\t\tquerystring.d = data.day ? data.day : 'any';\n\t\tif (data.time) querystring.i = data.time;\n\t\tif (data.region) querystring.r = data.region;\n\t\tif (data.type) querystring.t = data.type;\n\t\tquerystring.v = $('#meetings .toggle-view.active').attr('data-id');\n\t\tquerystring = jQuery.param(querystring);\n\t\t//console.log('querystring is ' + querystring)\n\t\t\n\t\t//save the query in the query string, if the browser is up to it\n\t\tif (history.pushState) {\n\t\t\tvar url = window.location.protocol + '//' + window.location.host + window.location.pathname;\n\t\t\tif (querystring.length) url = url + '?' + querystring;\n\t\t\tif (location.search.indexOf('post_type=meetings') > -1) {\n\t\t\t\turl = url + ((url.indexOf('?') > -1) ? '&' : '?') + 'post_type=meetings';\n\t\t\t}\n\t\t\twindow.history.pushState({path:url}, '', url);\n\t\t}\n\t\t\n\t\t//prepare search terms for highlighter\n\t\tvar search = [];\n\t\tif (data.search) {\n\t\t\tsearch = data.search.split(' ');\n\t\t\tfor (var i = 0; i < search.length; i++) {\n\t\t\t\tsearch[i] = new RegExp( '(' + search[i] + ')', 'gi');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//debugging\n\t\t//console.log(myAjax.ajaxurl)\n\t\t//console.log(data);\n\n\t\t//request new meetings result\n\t\tjQuery.post(myAjax.ajaxurl, data, function(response){\n\t\t\tif (!response.length) {\n\n\t\t\t\t//if keyword and no results, clear other parameters and search again\n\t\t\t\tif (data.search && (typeof data.day !== 'undefined' || typeof data.region !== 'undefined' || typeof data.time !== 'undefined' || typeof data.type !== 'undefined')) {\n\t\t\t\t\t$('#day li').removeClass('active').first().addClass('active');\n\t\t\t\t\t$('#time li').removeClass('active').first().addClass('active');\n\t\t\t\t\t$('#region li').removeClass('active').first().addClass('active');\n\t\t\t\t\t$('#type li').removeClass('active').first().addClass('active');\n\n\t\t\t\t\t//set selected text\n\t\t\t\t\t$('#day span.selected').html($('#day li:first-child a').html());\n\t\t\t\t\t$('#time span.selected').html($('#time li:first-child a').html());\n\t\t\t\t\t$('#region span.selected').html($('#region li:first-child a').html());\n\t\t\t\t\t$('#type span.selected').html($('#type li:first-child a').html());\n\t\t\t\t\treturn doSearch();\n\t\t\t\t}\n\n\t\t\t\t$('#meetings table').addClass('hidden');\n\t\t\t\t$('#meetings #map').addClass('hidden');\n\t\t\t\t$('#alert').html('No results matched those criteria.').removeClass('hidden');\n\t\t\t} else {\n\t\t\t\t$('#meetings table').removeClass('hidden');\n\t\t\t\tif ($('#meetings #map').hasClass('hidden')) {\n\t\t\t\t\t$('#meetings #map').removeClass('hidden');\n\t\t\t\t\tgoogle.maps.event.trigger(map, 'resize');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$('#alert').addClass('hidden');\n\n\t\t\t\tvar locations = [];\n\n\t\t\t\tvar tbody = $('#meetings_tbody').html('');\n\n\t\t\t\t//loop through JSON meetings\n\t\t\t\tjQuery.each(response, function(index, obj){\n\n\t\t\t\t\t//add gender designation\n\t\t\t\t\tif (jQuery.inArray('M', obj.types) != -1) {\n\t\t\t\t\t\tobj.name += ' <small>Men</small>';\n\t\t\t\t\t} else if (jQuery.inArray('W', obj.types) != -1) {\n\t\t\t\t\t\tobj.name += ' <small>Women</small>';\n\t\t\t\t\t}\n\n\t\t\t\t\t//save location info\n\t\t\t\t\tif (!locations[obj.location_id]) {\n\t\t\t\t\t\tlocations[obj.location_id] = {\n\t\t\t\t\t\t\tname: obj.location,\n\t\t\t\t\t\t\taddress: obj.address,\n\t\t\t\t\t\t\tlatitude: obj.latitude,\n\t\t\t\t\t\t\tlongitude: obj.longitude,\n\t\t\t\t\t\t\tcity: obj.city,\n\t\t\t\t\t\t\tstate: obj.state,\n\t\t\t\t\t\t\turl: obj.location_url,\n\t\t\t\t\t\t\tmeetings: []\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t//push meeting on to location\n\t\t\t\t\tlocations[obj.location_id].meetings[locations[obj.location_id].meetings.length] = {\n\t\t\t\t\t\tname : obj.name,\n\t\t\t\t\t\ttime : obj.time_formatted,\n\t\t\t\t\t\tday : obj.day,\n\t\t\t\t\t\tnotes : obj.notes,\n\t\t\t\t\t\turl : obj.url\n\t\t\t\t\t};\n\n\t\t\t\t\tvar sort_time = obj.day + '-' + (obj.time == '00:00' ? '11:59' : obj.time);\n\t\t\t\t\t\n\t\t\t\t\t//add new table row\n\t\t\t\t\ttbody.append('<tr>' + \n\t\t\t\t\t\t'<td class=\"time\" data-sort=\"' + sort_time + '\"><span>' + (data.day || !obj.day ? obj.time_formatted : days[obj.day] + '</span><span>' + obj.time_formatted) + '</span></td>' + \n\t\t\t\t\t\t'<td class=\"name\" data-sort=\"' + obj.name + '-' + sort_time + '\">' + formatLink(obj.url, highlight(obj.name, search), 'post_type') + '</td>' + \n\t\t\t\t\t\t'<td class=\"location\" data-sort=\"' + obj.location + '-' + sort_time + '\">' + highlight(obj.location, search) + '</td>' + \n\t\t\t\t\t\t'<td class=\"address\" data-sort=\"' + obj.address + '-' + sort_time + '\">' + highlight(obj.address, search) + '</td>' + \n\t\t\t\t\t\t'<td class=\"region\" data-sort=\"' + (obj.sub_region || obj.region || '') + '-' + sort_time + '\">' + (obj.sub_region || obj.region || '') + '</td>' + \n\t\t\t\t\t\t'<td class=\"types visible-print-block\">' + decodeMeetingTypes(obj.types) + '</td>' + \n\t\t\t\t\t'</tr>')\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tsortMeetings();\n\n\t\t\t\t//remove old markers and reset bounds\n\t\t\t\tfor (var i = 0; i < markers.length; i++) markers[i].setMap(null);\n\t\t\t\tmarkers = [];\n\t\t\t\tbounds = new google.maps.LatLngBounds;\n\n\t\t\t\tloadMap(locations);\n\t\t\t}\n\t\t}, 'json');\t\n\t}\n\t\n\t//table sorting\n\t$('#meetings table thead').on('click', 'th', function(){\n\t\tvar sort = $(this).attr('class');\n\t\tvar order;\n\n\t\t//update header\n\t\tif ($(this).attr('data-sort')) {\n\t\t\torder = ($(this).attr('data-sort') == 'asc') ? 'desc' : 'asc';\n\t\t} else {\n\t\t\torder = 'asc';\n\t\t}\n\t\t$('#meetings table thead th').removeAttr('data-sort');\n\t\t$('#meetings table thead th.' + sort).attr('data-sort', order);\n\t\tsortMeetings();\n\t});\n\t\n\tfunction sortMeetings() {\n\t\t$sorted = $('#meetings table thead th[data-sort]').first();\n\t\tvar sort = $sorted.attr('class');\n\t\tvar order = $sorted.attr('data-sort');\n\t\tvar tbody = document.getElementById('meetings_tbody');\n\t\tvar store = [];\n\t\tvar sort_index = $('#meetings table thead th').index($sorted);\n\n\t\t//execute sort\n\t\tfor (var i = 0, len = tbody.rows.length; i < len; i++) {\n\t\t\tvar row = tbody.rows[i];\n\t\t\tstore.push([row.cells[sort_index].getAttribute('data-sort'), row]);\n\t\t}\n\t\tstore.sort(function(x,y){\n\t\t\tif (x[0] > y[0]) return (order == 'asc') ? 1 : -1;\n\t\t\tif (x[0] < y[0]) return (order == 'asc') ? -1 : 1;\n\t\t\treturn 0;\n\t\t});\n\t\tfor (var i = 0, len = store.length; i < len; i++){\n\t\t\ttbody.appendChild(store[i][1]);\n\t\t}\t\t\n\t}\n\t\n\t//highlight search string\n\tfunction highlight(str, terms) {\n\t\tif (!terms.length) return str;\n\t\tfor (var i = 0; i < terms.length; i++) {\n\t\t\tstr = str.replace(terms[i], '<mark>$1</mark>')\n\t\t}\n\t\treturn str;\n\t}\n\n\t//capture submit event\n\t$('#meetings #search').submit(function(e){\n\t\tdoSearch();\n\t\treturn false;\n\t});\n\n\t//capture dropdown change\n\t$('#meetings .controls').on('click', '.dropdown-menu a', function(e){\n\t\te.preventDefault();\n\n\t\t//day only one selected\n\t\tif ($(this).closest('.dropdown').attr('id') == 'day') {\n\t\t\t$('#day li').removeClass('active');\n\t\t\t$('#day span.selected').html($(this).html());\n\t\t}\n\n\t\t//times only one\n\t\tif ($(this).closest('.dropdown').attr('id') == 'time') {\n\t\t\t$('#time li').removeClass('active');\n\t\t\t$('#time span.selected').html($(this).html());\n\t\t}\n\n\t\t//location only one\n\t\tif ($(this).closest('.dropdown').attr('id') == 'region') {\n\t\t\t$('#region li').removeClass('active');\n\t\t\t$('#region span.selected').html($(this).html());\n\t\t}\n\n\t\t//type only one\n\t\tif ($(this).closest('.dropdown').attr('id') == 'type') {\n\t\t\t$('#type li').removeClass('active');\n\t\t\t$('#type span.selected').html($(this).html());\n\t\t}\n\n\t\t$(this).parent().toggleClass('active');\n\n\t\tupdateTitle();\n\t\tdoSearch();\n\t});\n\n\t//toggle between list and map\n\t$('#meetings #action .toggle-view').click(function(e){\n\t\te.preventDefault();\n\t\t\n\t\t//what's going on\n\t\tvar action = $(this).attr('data-id');\n\t\tvar previous = $('#meetings').attr('data-type');\n\n\t\t//save the query in the query string, if the browser is up to it\n\t\tif (history.pushState) {\n\t\t\tvar url = updateQueryString('v', action);\n\t\t\twindow.history.pushState({path:url}, '', url);\n\t\t}\n\t\t\n\t\t//toggle control, meetings div\n\t\tif (action == 'list') {\n\t\t\tcloseFullscreen();\n\t\t\t$('#meetings #action .toggle-view[data-id=list]').addClass('active');\n\t\t\t$('#meetings #action .toggle-view[data-id=map]').removeClass('active');\t\t\t\n\t\t} else if (action == 'map') {\n\t\t\t$('#meetings #action .toggle-view[data-id=map]').addClass('active');\n\t\t\t$('#meetings #action .toggle-view[data-id=list]').removeClass('active');\t\t\t\n\t\t}\n\n\t\t//set meetings div\n\t\t$('#meetings').attr('data-type', action);\n\t\t\n\t\t//wake up the map if needed\n\t\tif (action == 'map' && action != previous) {\n\t\t\tgoogle.maps.event.trigger(map, 'resize');\n\t\t\tmap.fitBounds(bounds);\n\t   \t\tif ((markers.length == 1) && $('#map').is(':visible')) {\n\t   \t\t\tmap.setZoom(14);\n\t   \t\t\tgoogle.maps.event.trigger(markers[0],'click');\n\t   \t\t}\n\t\t}\n\t});\n\n\t$('a[href=\"#geolocator\"]').click(function(e){\n\t\te.preventDefault();\n\t\t$(this).toggleClass('active');\n\n\t\tif ($(this).hasClass('active')) {\n\t\t\tnavigator.geolocation.getCurrentPosition(function(position) {\n\t\t\t\tvar pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\n\n\t\t\t\tuserMarker = new google.maps.Marker({\n\t\t\t\t\ticon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',\n\t\t\t\t\tposition: pos,\n\t\t\t\t\tmap: map,\n\t\t\t\t\ttitle: 'You'\n\t\t\t\t});\n\n\t\t\t\tmap.setCenter(pos);\n\t\t\t\tmap.setZoom(13);\n\t\t\t}, function(err) {\n  \t\t\t\tconsole.log('ERROR(' + err.code + '): ' + err.message);\n  \t\t\t\t$(this).removeClass('active')\n  \t\t\t});\n\t\t} else if (userMarker !== undefined) {\n\t\t\tuserMarker.setMap(null);\n\t\t}\n\t});\n\n\t$('a[href=\"#fullscreen\"]').click(function(e){\n\t\te.preventDefault();\n\t\tvar center = map.getCenter();\n\t\t$(this).toggleClass('active');\n\t\tif ($(this).hasClass('active')) {\n\t\t\t$('body').addClass('tsml_fullscreen');\n\t\t\tvar height = $(window).height() - 79;\n\t\t\tif ($('body').hasClass('admin-bar')) height -= 32;\n\t\t\t$('#map').css('height', height);\n\t\t} else {\n\t\t\tcloseFullscreen();\n\t\t}\n\t\tgoogle.maps.event.trigger(map, 'resize');\n\t\tmap.setCenter(center);\n\t});\n\n\t//remove fullscreen with an escape key press\n\t$(document).keyup(function(e) {\n\t\tif (e.keyCode == 27) closeFullscreen();\n\t});\n\t\n\tfunction closeFullscreen() {\n\t\tif ($('body').hasClass('tsml_fullscreen')) {\n\t\t\t$('body').removeClass('tsml_fullscreen');\n\t\t\t$('a[href=\"#fullscreen\"]').removeClass('active');\n\t\t\t$('a[href=\"#fullscreen\"]').parent().removeClass('active');\n\t\t\t$('#map').css('height', 550);\n\t\t}\n\t}\n\t\n\t//save a string of the current state to the title bar, so that it prints nicely\n\tfunction updateTitle() {\n\t\tvar string = '';\n\t\tif ($('#meetings #day li.active').index()) {\n\t\t\tstring += $('#meetings #day span.selected').text();\n\t\t}\n\t\tif ($('#meetings #time li.active').index()) {\n\t\t\tstring += ' ' + $('#meetings #time span.selected').text();\n\t\t}\n\t\tif ($('#meetings #type li.active').index()) {\n\t\t\tstring += ' ' + $('#meetings #type span.selected').text();\n\t\t}\n\t\tstring += ' Meetings';\n\t\tif ($('#meetings #region li.active').index()) {\n\t\t\tstring += ' in ' + $('#meetings #region span.selected').text();\n\t\t}\n\t\tdocument.title = string;\n\t}\n\tif ($('body').hasClass('post-type-archive-meetings')) updateTitle();\n\t\n\t//decode meeting types for ajax table rows\n\tfunction decodeMeetingTypes(codes) {\n\t\tvar return_types = [];\n\t\tfor (var i = 0; i < codes.length; i++) {\n\t\t\treturn_types[return_types.length] = myAjax.types[codes[i]];\n\t\t}\n\t\treturn_types.sort();\n\t\treturn return_types.join(', ');\n\t}\n\t\n\t//resize fullscreen on resize\n\t$(window).resize(function(e){\n\t\tif ($('#meetings').hasClass('tsml_fullscreen')) {\n\t\t\tvar center = map.getCenter();\n\t\t\tvar height = $(window).height() - 79;\n\t\t\tif ($('body').hasClass('admin-bar')) height -= 32;\n\t\t\t$('#map').css('height', height);\n\t\t\tgoogle.maps.event.trigger(map, 'resize');\n\t\t\tmap.setCenter(center);\n\t\t}\n\t});\n\t\n});\n\n//globals\nmarkers = [];\nmap = new google.maps.Map(document.getElementById('map'), {\n\tpanControl: false,\n\tmapTypeControl: false,\n\tmapTypeControlOptions: {\n\t\tmapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']\n\t}\n});\nbounds = new google.maps.LatLngBounds();\n\ndays = [ 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n\ninfowindow = new google.maps.InfoWindow();\n\n\n//load map, called from archive-meetings.php\nfunction loadMap(locations) {\n\n\tfor (var location_id in locations) {\n\t\tif (locations.hasOwnProperty(location_id)) {\n\t\t\t//console.log(locations[location_id]);\n\t\t\t\n\t\t\tvar location = locations[location_id];\n\t\t\t\n\t\t\t//set new marker\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\tposition: {lat: location.latitude - 0, lng: location.longitude - 0},\n\t\t\t\tmap: map,\n\t\t\t\ttitle: location.name,\n\t\t\t});\n\n\t\t\t//create infowindow content\n\t\t\tmarker.content = '<div class=\"infowindow\"><h3>' + formatLink(location.url, location.name, 'post_type') + '</h3>' +\n\t\t\t\t'<address>' + location.address + '<br>' + location.city + (location.state ? ', ' + location.state : '') + '</address>';\n\t\t\t\t\n\t\t\tvar current_day = null;\n\t\t\tfor (var i = 0; i < location.meetings.length; i++) {\n\t\t\t\tvar meeting = location.meetings[i];\n\t\t\t\tif (current_day != meeting.day) {\n\t\t\t\t\tif (current_day) marker.content += '</dl>';\n\t\t\t\t\tcurrent_day = meeting.day;\n\t\t\t\t\tif (typeof days[current_day] !== 'undefined') marker.content += '<h5>' + days[current_day] + '</h5>';\n\t\t\t\t\tmarker.content += '<dl>';\n\t\t\t\t}\n\t\t\t\tmarker.content += '<dt>' + meeting.time + '</dt><dd>' + formatLink(meeting.url, meeting.name, 'post_type') + '</dd>';\n\t\t\t}\n\t\t\tmarker.content += '</dl></div>';\n\t\t\t\n\t\t\t//add infowindow event\n\t\t\tgoogle.maps.event.addListener(marker, 'click', (function(marker) {\n\t\t\t\treturn function() {\n\t\t\t\t\tinfowindow.setContent(marker.content);\n\t\t\t\t\tinfowindow.open(map, marker);\n\t\t\t\t}\n\t\t\t})(marker));\n\t\n\t\t\t//add to map bounds\n\t\t\tbounds.extend(marker.position);\n\t\t\t\n\t\t\tmarkers[markers.length] = marker;\n\t\t}\n\t}\n\n\tif (markers.length > 1) {\n\t\tmap.fitBounds(bounds);\n\t} else if (markers.length == 1) {\n\t\tmap.setCenter(bounds.getCenter());\n\t\tif (jQuery('#map').is(':visible')) google.maps.event.trigger(markers[0],'click');\n\t\tmap.setZoom(14);\n\t} else if (markers.length == 0) {\n\t\t//currently holds last position, not sure if that's good\n\t}\n\t\n}\n\n//format a link to a meeting result page, preserving all but the excluded query string keys\nfunction formatLink(url, text, exclude) {\n\tvar query_pairs = location.search.substr(1).split('&');\n\tvar new_query_pairs = [];\n\tfor (var i = 0; i < query_pairs.length; i++) {\n\t\tvar query_parts = query_pairs[i].split('=');\n\t\tif (query_parts[0] != exclude) new_query_pairs[new_query_pairs.length] = query_parts[0] + '=' + query_parts[1];\n\t}\n\tif (new_query_pairs.length) {\n\t\turl += ((url.indexOf('?') == -1) ? '?' : '&') + new_query_pairs.join('&');\n\t}\n\treturn '<a href=\"' + url + '\">' + text + '</a>';\n}\n\nfunction updateQueryString(key, value, url) {\n\tif (!url) url = window.location.href;\n\tvar re = new RegExp(\"([?&])\" + key + \"=.*?(&|#|$)(.*)\", \"gi\"), hash;\n\n\tif (re.test(url)) {\n\t\tif (typeof value !== 'undefined' && value !== null) {\n\t\t\treturn url.replace(re, '$1' + key + \"=\" + value + '$2$3');\n\t\t} else {\n\t\t\thash = url.split('#');\n\t\t\turl = hash[0].replace(re, '$1$3').replace(/(&|\\?)$/, '');\n\t\t\tif (typeof hash[1] !== 'undefined' && hash[1] !== null) url += '#' + hash[1];\n\t\t\treturn url;\n\t\t}\n\t} else {\n\t\tif (typeof value !== 'undefined' && value !== null) {\n\t\t\tvar separator = url.indexOf('?') !== -1 ? '&' : '?';\n\t\t\thash = url.split('#');\n\t\t\turl = hash[0] + separator + key + '=' + value;\n\t\t\tif (typeof hash[1] !== 'undefined' && hash[1] !== null) url += '#' + hash[1];\n\t\t\treturn url;\n\t\t} else {\n\t\t\treturn url;\n\t\t}\n\t}\n}\n"],"sourceRoot":"/source/"}