jQuery(function(t){function e(e,a){if(!e||!a)return void t("div#map").html("");var n=new google.maps.LatLng(e,a),o=new google.maps.Map(document.getElementById("map"),{zoom:16,zoomControl:!1,scrollwheel:!1,streetViewControl:!1,mapTypeControl:!1,center:n});new google.maps.Marker({position:n,map:o})}function a(t){for(var e,a,n,o,i,l,r,s=[],u=0;u<t.length;u++){var p=t[u];p.types.length&&"point_of_interest"!=p.types[0]?p.types.indexOf("neighborhood")!==-1?a=p.short_name:p.types.indexOf("street_number")!==-1?n=p.long_name:p.types.indexOf("route")!==-1?n=n?n+" "+p.long_name:p.long_name:p.types.indexOf("locality")!==-1?o=p.long_name:p.types.indexOf("sublocality")!==-1?o||(o=p.long_name):p.types.indexOf("administrative_area_level_3")!==-1?o||(o=p.long_name):p.types.indexOf("administrative_area_level_1")!==-1?i=p.short_name:p.types.indexOf("postal_code")!==-1?l=p.short_name:p.types.indexOf("country")!==-1&&(r=p.short_name):e=p.short_name}return!n&&e&&(n=e),!n&&a&&(n=a),n&&(s[s.length]=n),o&&(s[s.length]=o),i?n&&l?s[s.length]=i+" "+l:s[s.length]=i:l&&(s[s.length]=l),r&&(s[s.length]=r),{address:n,city:o,state:i,postal_code:l,country:r,formatted:s.join(", ")}}t("select#day").change(function(){var e=t(this).val(),a=t("input#time");e?(t("input#time").removeAttr("disabled"),!a.val()&&a.attr("data-value")&&a.val(a.attr("data-value"))):a.attr("data-value",a.val()).val("").attr("disabled","disabled")}),t("#get_feedback table span").click(function(){t(this).parent().submit()});var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=location"}});n.initialize(),t("input#location").typeahead(null,{displayKey:"value",source:n.ttAdapter()}).on("typeahead:autocompleted",function(a,n){t("input[name=formatted_address]").val(n.formatted_address),t("input[name=latitude]").val(n.latitude),t("input[name=longitude]").val(n.longitude),t("input[name=address]").val(n.address),t("input[name=city]").val(n.city),t("input[name=state]").val(n.state),t("input[name=postal_code]").val(n.postal_code),t("input[name=country]").val(n.country),t("select[name=region] option[value="+n.region+"]").prop("selected",!0),t("textarea[name=location_notes]").val(n.notes),e(n.latitude,n.longitude)});var o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=tsml_group",ttl:10}});o.initialize(),t("input#group").typeahead(null,{displayKey:"value",source:o.ttAdapter()}).on("typeahead:autocompleted",function(e,a){t("input[name=contact_1_name]").val(a.contact_1_name),t("input[name=contact_1_email]").val(a.contact_1_email),t("input[name=contact_1_phone]").val(a.contact_1_phone),t("input[name=contact_2_name]").val(a.contact_2_name),t("input[name=contact_2_email]").val(a.contact_2_email),t("input[name=contact_2_phone]").val(a.contact_2_phone),t("input[name=contact_3_name]").val(a.contact_3_name),t("input[name=contact_3_email]").val(a.contact_3_email),t("input[name=contact_3_phone]").val(a.contact_3_phone),t("textarea[name=group_notes]").val(a.notes)}),t("input#group").change(function(){t("div#group .apply_group_to_location").removeClass("hidden")}),t("form#post").submit(function(){if(!t("select#day").val())return t("input#time").val(""),!0;var e=t("input#time").val(),a=!1;5!=e.length&&(a=!0),2!=e.indexOf(":")&&(a=!0);var n=e.substr(0,2),o=e.substr(3,2);return(isNaN(n)||n<0||n>23)&&(a=!0),(isNaN(o)||o<0||o>59)&&(a=!0),!a||(alert("Time should be 24-hour format HH:MM."),!1)}),t("input#formatted_address").blur(function(){t("input#address").val(""),t("input#city").val(""),t("input#state").val(""),t("input#zip").val(""),t("input#country").val(""),t("input#latitude").val(""),t("input#longitude").val("");var n=t(this).val().trim();return n.length?void jQuery.getJSON("https://maps.googleapis.com/maps/api/geocode/json",{address:n,key:myAjax.google_api_key},function(o){if("OK"==o.status){var i=o.results[0].geometry.location.lat,l=o.results[0].geometry.location.lng;t("input#latitude").val(i),t("input#longitude").val(l),e(i,l);var r=!1;t("select#region option[selected]").size()||(n=o.results[0].formatted_address,t("select#region option").each(function(){var e=t(this).text().replace("&nbsp;","").trim();n.indexOf(e)!=-1&&(r=t(this).attr("value"))}));var s=a(o.results[0].address_components);t("input#address").val(s.address),t("input#city").val(s.city),t("input#state").val(s.state),t("input#postal_code").val(s.postal_code),t("input#country").val(s.country),t("input#formatted_address").val(s.formatted),jQuery.getJSON(myAjax.ajaxurl+"?action=address",{formatted_address:s.formatted},function(e){e?(t("input[name=location]").val(e.location),t("select[name=region] option").prop("selected",!1),t("select[name=region] option[value="+e.region+"]").prop("selected",!0),t("textarea[name=location_notes]").val(e.location_notes)):r&&(t("select[name=region] option").prop("selected",!1),t("select[name=region] option[value="+r+"]").prop("selected",!0))})}}):(e(),void t("input#formatted_address").val(""))}),t("input#formatted_address").val()&&t("input#formatted_address").blur()});