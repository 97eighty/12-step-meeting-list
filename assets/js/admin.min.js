jQuery(function(e){function t(t,a){if(!t||!a)return void e("div#map").html("");var n=new google.maps.LatLng(t,a),o=new google.maps.Map(document.getElementById("map"),{zoom:16,zoomControl:!1,scrollwheel:!1,streetViewControl:!1,mapTypeControl:!1,center:n});new google.maps.Marker({position:n,map:o})}function a(e){for(var t,a,n,o,i,l,s,r=[],p=0;p<e.length;p++){var d=e[p];d.types.length&&"point_of_interest"!=d.types[0]?d.types.indexOf("neighborhood")!==-1?a=d.short_name:d.types.indexOf("street_number")!==-1?n=d.long_name:d.types.indexOf("route")!==-1?n=n?n+" "+d.long_name:d.long_name:d.types.indexOf("locality")!==-1?o=d.long_name:d.types.indexOf("sublocality")!==-1?o||(o=d.long_name):d.types.indexOf("administrative_area_level_3")!==-1?o||(o=d.long_name):d.types.indexOf("administrative_area_level_1")!==-1?i=d.short_name:d.types.indexOf("postal_code")!==-1?l=d.short_name:d.types.indexOf("country")!==-1&&(s=d.short_name):t=d.short_name}return!n&&t&&(n=t),!n&&a&&(n=a),n&&(r[r.length]=n),o&&(r[r.length]=o),i?n&&l?r[r.length]=i+" "+l:r[r.length]=i:l&&(r[r.length]=l),s&&(r[r.length]=s),{address:n,city:o,state:i,postal_code:l,country:s,formatted_address:r.join(", ")}}e("select#day").change(function(){var t=e(this).val(),a=e("input#time");t?(e("input#time").removeAttr("disabled"),!a.val()&&a.attr("data-value")&&a.val(a.attr("data-value"))):a.attr("data-value",a.val()).val("").attr("disabled","disabled")}),e("body.post-type-meetings form#post").on("change",'input[name="types[]"]',function(){e('body.post-type-meetings form#post input[name="types[]"][value="C"]').prop("checked")&&e('body.post-type-meetings form#post input[name="types[]"][value="O"]').prop("checked")&&("C"==e(this).val()?e('body.post-type-meetings form#post input[name="types[]"][value="O"]').prop("checked",!1):e('body.post-type-meetings form#post input[name="types[]"][value="C"]').prop("checked",!1))}),e("#get_feedback table span").click(function(){e(this).parent().submit()});var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=location"}});n.initialize(),e("input#location").typeahead(null,{displayKey:"value",source:n.ttAdapter()}).on("typeahead:autocompleted",function(a,n){e("input[name=formatted_address]").val(n.formatted_address),e("input[name=latitude]").val(n.latitude),e("input[name=longitude]").val(n.longitude),e("input[name=address]").val(n.address),e("input[name=city]").val(n.city),e("input[name=state]").val(n.state),e("input[name=postal_code]").val(n.postal_code),e("input[name=country]").val(n.country),e("select[name=region] option[value="+n.region+"]").prop("selected",!0),e("textarea[name=location_notes]").val(n.notes),t(n.latitude,n.longitude)});var o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:myAjax.ajaxurl+"?action=tsml_group",ttl:10}});o.initialize(),e("input#group").typeahead(null,{displayKey:"value",source:o.ttAdapter()}).on("typeahead:autocompleted",function(t,a){e("input[name=contact_1_name]").val(a.contact_1_name),e("input[name=contact_1_email]").val(a.contact_1_email),e("input[name=contact_1_phone]").val(a.contact_1_phone),e("input[name=contact_2_name]").val(a.contact_2_name),e("input[name=contact_2_email]").val(a.contact_2_email),e("input[name=contact_2_phone]").val(a.contact_2_phone),e("input[name=contact_3_name]").val(a.contact_3_name),e("input[name=contact_3_email]").val(a.contact_3_email),e("input[name=contact_3_phone]").val(a.contact_3_phone),e("textarea[name=group_notes]").val(a.notes)}),e("input#group").change(function(){e("div#group .apply_group_to_location").removeClass("hidden")}),e("form#post").submit(function(){if(!e("select#day").val())return e("input#time").val(""),!0;var t=e("input#time").val(),a=!1;5!=t.length&&(a=!0),2!=t.indexOf(":")&&(a=!0);var n=t.substr(0,2),o=t.substr(3,2);return(isNaN(n)||n<0||n>23)&&(a=!0),(isNaN(o)||o<0||o>59)&&(a=!0),!a||(alert("Time should be 24-hour format HH:MM."),!1)}),e("input#formatted_address").blur(function(){e("input#address").val(""),e("input#city").val(""),e("input#state").val(""),e("input#zip").val(""),e("input#country").val(""),e("input#latitude").val(""),e("input#longitude").val("");var n=e(this).val().trim();return n.length?void jQuery.getJSON("https://maps.googleapis.com/maps/api/geocode/json",{address:n,key:myAjax.google_api_key},function(o){if("OK"==o.status){var i=jQuery.parseJSON(myAjax.google_overrides);if("undefined"==typeof i[o.results[0].formatted_address]){var l=a(o.results[0].address_components);l.latitude=o.results[0].geometry.location.lat,l.longitude=o.results[0].geometry.location.lng}else var l=i[o.results[0].formatted_address];e("input#latitude").val(l.latitude),e("input#longitude").val(l.longitude),t(l.latitude,l.longitude);var s=!1;e("select#region option[selected]").size()||(n=l.formatted_address,e("select#region option").each(function(){var t=e(this).text().replace("&nbsp;","").trim();n.indexOf(t)!=-1&&(s=e(this).attr("value"))})),e("input#address").val(l.address),e("input#city").val(l.city),e("input#state").val(l.state),e("input#postal_code").val(l.postal_code),e("input#country").val(l.country),e("input#formatted_address").val(l.formatted_address),jQuery.getJSON(myAjax.ajaxurl+"?action=address",{formatted_address:l.formatted_address},function(t){t?(e("input[name=location]").val(t.location),e("select[name=region] option").prop("selected",!1),e("select[name=region] option[value="+t.region+"]").prop("selected",!0),e("textarea[name=location_notes]").val(t.location_notes)):s&&(e("select[name=region] option").prop("selected",!1),e("select[name=region] option[value="+s+"]").prop("selected",!0))})}}):(t(),void e("input#formatted_address").val(""))}),e("input#formatted_address").val()&&e("input#formatted_address").blur()});